<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>my little astral being</title>
		<meta name="description" content="look after your own astral pet!">

		<link rel="stylesheet" href="/styles/main.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
		<script src="scripts/main.js"></script>
	</head>
	<body class="hide">
		<div id="overlay"><div id="overlay-box"></div></div>
		<div id="pet-name-dialog" title="a strange crystal falls from the sky...">
			you pick it up and feel the vibrations from its energy field.
			<br/><br/>
			when you get home, you put it in a safe place.
			<br/><br/>
			the crystal glistens in the
			<a data-cyclinglink='{ "variable": "variableToSet", "type": "desc",
				"options": [
				"vibrant beam of golden sunlight",
				"pale silver curtain of moonlight",
				"glowing aura of your laptop screen"
				]}'></a>
			<br/><br/>
			a small crack is appearing on the egg-shaped stone.
			<br/><br/>
			could it be?
			<br/><br/>
			is this an astral being?
			<br/><br/>
			what do you want to call it?
			<br/><br/>
			<span id="pet-name" data-contenteditable="true" data-initial="Fluffy"></span>.
		</div>

		<canvas id="petcanvas"></canvas>

		<div class="bottom">
		<div id="menu">
			<ul>
				<li><a href="#pet-data">data</a></li>
				<li><a href="#pet-element-stats">elements</a></li>
			</ul>
			<div id="pet-data">
				<div>
					<span data-showvariable="pet.name"></span> is <span data-showvariable="pet.body.species.articleName()"></span>
				</div>
				<div>
					<div class="progress-label">dusty:</div>
					<div class="progress-wrapper">
						<progress class="silver" data-event='pet:body:dust:change' data-progress='pet.body.dust' data-max='100'></progress>
					</div>
				</div>
			</div>
			<div id="pet-element-stats">
				<table data-arraytotable="pet.soul.elements.toTableArray()"></table>
			</div>
		</div>
		</div>

		<div class="top centerText">
			<button id="daybutton">go to sleep</button>
		</div>

		<script type="text/javascript">
		$(function()
		{
			$("#menu").tabs();

			$("#daybutton").button().click(function(e)
			{
				e.preventDefault();
				pet.runDay();
			});

			$.ui.dialog.prototype._title = function(title)
			{
				title.html(this.options.title);
			};

			var easing = "easeInCubic";
			var duration = 1000;
			$.extend($.ui.dialog.prototype.options,
			{
				dialogClass: "no-close",
				modal: true,
				resizable: false,
				draggable: false,
				minWidth: 350,
				width: $(window).width() * 0.4,
				beforeClose: function()
				{
					$('.ui-widget-overlay:first')
						.clone()
						.appendTo('body')
						.show()
						.fadeOut(duration * 2, easing, function()
						{
							$(this).remove();
						});
				},
				hide: { effect: "fade", duration: duration, easing: easing },
				show: { effect: "fade", duration: duration, easing: easing }
			});

			$("#pet-name-dialog").dialog(
			{
				buttons:
				[{
					'data-setvariable':'{ "variable": "pet.name", "type": "desc", "element": "#pet-name" }',
					text: "OK",
					click: function()
					{
						$(this).dialog( "close" );
					}
				}]
			});

			for (var i = 0; i < document.styleSheets.length; i++)
			{
				ss = document.styleSheets[i];
				var tags = ["color", "border-top", "background", "background-color"];
				var petColour = ElementColours[pet.soul.highestElement.name].html;
				var petColourDark = tinycolor(petColour).darken(20).toHexString();

				for (var j = 0; j < ss.cssRules.length; j++)
				{
					rules = ss.cssRules[j];
					if (typeof rules == "undefined")
					{
						continue;
					}
					if (typeof rules.style == "undefined")
					{
						continue;
					}
					if (typeof rules.style.cssText != "undefined")
					{
						if (rules.style.cssText.indexOf("lime") > -1)
						{
							rules.style.cssText = rules.style.cssText.replace("lime", petColour);
						}
						if (rules.style.cssText.indexOf("blue") > -1)
						{
							rules.style.cssText = rules.style.cssText.replace("blue", petColourDark);
						}
					}
				}
			}
		});
		</script>
	</body>
</html>
